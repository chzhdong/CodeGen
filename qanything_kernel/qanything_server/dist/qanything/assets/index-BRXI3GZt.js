import{u as e,H as a}from"./Head-SSgi6Sek.js";import{r as t,u as l,a as o,b as s}from"./utils-DgQiGfGs.js";import{u as n,a as i,p as r,b as d,_ as u,f as c,c as p,C as m}from"./useUploadFiles-CJjF3D36.js";import{g as v,u as g}from"./index-B-VGBmzJ.js";import{g as h,m as f,_ as b,d as k,c as y,u as _,r as x,p as w,a as C,I as A,i as S,b as I,s as B,w as F,o as L,e as $,f as q,h as j,P as z,t as E,j as M,k as T,l as O,n as D,q as H,v as N,x as U,y as V,z as Q,A as P,B as R,C as K,D as G,E as Y,F as Z,G as W,H as X,J,S as ee,K as ae,L as te,T as le,M as oe,N as se,O as ne,Q as ie,R as re,U as de,V as ue,W as ce,X as pe}from"./index-BOQWRSv-.js";import{I as me}from"./index-C23k2m5x.js";import{_ as ve}from"./index-CMd10nF3.js";import{_ as ge,F as he,u as fe}from"./useChatSetting-C_Q_RWik.js";import{M as be}from"./useChatSource-CVdT_vQJ.js";import{u as ke}from"./useQuickStart-DmSRwdo_.js";import{L as ye,_ as _e}from"./ActionButton-kxRHFmPt.js";import{u as xe}from"./useBots-DbnaIHJs.js";import{u as we}from"./useBotsChat-BkotZGHn.js";import{r as Ce}from"./router-c0GRtipE.js";import{_ as Ae}from"./knowledge-zhu8jsrY.js";import{_ as Se}from"./ChatSourceDialog.vue_vue_type_script_setup_true_lang-j6xIvHBh.js";import{S as Ie,a as Be}from"./injectionKey-BS_bSTfS.js";import{R as Fe}from"./RightOutlined-k6Ldo487.js";import"./index-8w8lTtg9.js";import"./index-C0drqHzp.js";import"./collapseMotion-CxcQHKaF.js";import"./class-FJ4HjPo2.js";import"./index-Cfg1_ubR.js";const Le=e=>{const{componentCls:a,colorBgContainer:t,colorBgBody:l,colorText:o}=e;return{[`${a}-sider-light`]:{background:t,[`${a}-sider-trigger`]:{color:o,background:t},[`${a}-sider-zero-width-trigger`]:{color:o,background:t,border:`1px solid ${l}`,borderInlineStart:0}}}},$e=e=>{const{antCls:a,componentCls:t,colorText:l,colorTextLightSolid:o,colorBgHeader:s,colorBgBody:n,colorBgTrigger:i,layoutHeaderHeight:r,layoutHeaderPaddingInline:d,layoutHeaderColor:u,layoutFooterPadding:c,layoutTriggerHeight:p,layoutZeroTriggerSize:m,motionDurationMid:v,motionDurationSlow:g,fontSize:h,borderRadius:f}=e;return{[t]:b(b({display:"flex",flex:"auto",flexDirection:"column",color:l,minHeight:0,background:n,"&, *":{boxSizing:"border-box"},[`&${t}-has-sider`]:{flexDirection:"row",[`> ${t}, > ${t}-content`]:{width:0}},[`${t}-header, &${t}-footer`]:{flex:"0 0 auto"},[`${t}-header`]:{height:r,paddingInline:d,color:u,lineHeight:`${r}px`,background:s,[`${a}-menu`]:{lineHeight:"inherit"}},[`${t}-footer`]:{padding:c,color:l,fontSize:h,background:n},[`${t}-content`]:{flex:"auto",minHeight:0},[`${t}-sider`]:{position:"relative",minWidth:0,background:s,transition:`all ${v}, background 0s`,"&-children":{height:"100%",marginTop:-.1,paddingTop:.1,[`${a}-menu${a}-menu-inline-collapsed`]:{width:"auto"}},"&-has-trigger":{paddingBottom:p},"&-right":{order:1},"&-trigger":{position:"fixed",bottom:0,zIndex:1,height:p,color:o,lineHeight:`${p}px`,textAlign:"center",background:i,cursor:"pointer",transition:`all ${v}`},"&-zero-width":{"> *":{overflow:"hidden"},"&-trigger":{position:"absolute",top:r,insetInlineEnd:-m,zIndex:1,width:m,height:m,color:o,fontSize:e.fontSizeXL,display:"flex",alignItems:"center",justifyContent:"center",background:s,borderStartStartRadius:0,borderStartEndRadius:f,borderEndEndRadius:f,borderEndStartRadius:0,cursor:"pointer",transition:`background ${g} ease`,"&::after":{position:"absolute",inset:0,background:"transparent",transition:`all ${g}`,content:'""'},"&:hover::after":{background:"rgba(255, 255, 255, 0.2)"},"&-right":{insetInlineStart:-m,borderStartStartRadius:f,borderStartEndRadius:0,borderEndEndRadius:0,borderEndStartRadius:f}}}}},Le(e)),{"&-rtl":{direction:"rtl"}})}},qe=h("Layout",(e=>{const{colorText:a,controlHeightSM:t,controlHeight:l,controlHeightLG:o,marginXXS:s}=e,n=1.25*o,i=f(e,{layoutHeaderHeight:2*l,layoutHeaderPaddingInline:n,layoutHeaderColor:a,layoutFooterPadding:`${t}px ${n}px`,layoutTriggerHeight:o+2*s,layoutZeroTriggerSize:o});return[$e(i)]}),(e=>{const{colorBgLayout:a}=e;return{colorBgHeader:"#001529",colorBgBody:a,colorBgTrigger:"#002140"}})),je=()=>({prefixCls:String,hasSider:{type:Boolean,default:void 0},tagName:String});function ze(e){let{suffixCls:a,tagName:t,name:l}=e;return e=>k({compatConfig:{MODE:3},name:l,props:je(),setup(l,o){let{slots:s}=o;const{prefixCls:n}=_(a,l);return()=>{const a=b(b({},l),{prefixCls:n.value,tagName:t});return y(e,a,s)}}})}const Ee=k({compatConfig:{MODE:3},props:je(),setup(e,a){let{slots:t}=a;return()=>y(e.tagName,{class:e.prefixCls},t)}}),Me=k({compatConfig:{MODE:3},inheritAttrs:!1,props:je(),setup(e,a){let{slots:t,attrs:l}=a;const{prefixCls:o,direction:s}=_("",e),[n,i]=qe(o),r=x([]);w(Ie,{addSider:e=>{r.value=[...r.value,e]},removeSider:e=>{r.value=r.value.filter((a=>a!==e))}});const d=C((()=>{const{prefixCls:a,hasSider:t}=e;return{[i.value]:!0,[`${a}`]:!0,[`${a}-has-sider`]:"boolean"==typeof t?t:r.value.length>0,[`${a}-rtl`]:"rtl"===s.value}}));return()=>{const{tagName:a}=e;return n(y(a,b(b({},l),{class:[d.value,l.class]}),t))}}}),Te=ze({suffixCls:"layout",tagName:"section",name:"ALayout"})(Me),Oe=ze({suffixCls:"layout-header",tagName:"header",name:"ALayoutHeader"})(Ee),De=ze({suffixCls:"layout-footer",tagName:"footer",name:"ALayoutFooter"})(Ee),He=ze({suffixCls:"layout-content",tagName:"main",name:"ALayoutContent"})(Ee);var Ne={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"bars",theme:"outlined"};function Ue(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),l.forEach((function(a){Ve(e,a,t[a])}))}return e}function Ve(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var Qe=function(e,a){var t=Ue({},e,a.attrs);return y(A,Ue({},t,{icon:Ne}),null)};Qe.displayName="BarsOutlined",Qe.inheritAttrs=!1;const Pe={xs:"479.98px",sm:"575.98px",md:"767.98px",lg:"991.98px",xl:"1199.98px",xxl:"1599.98px",xxxl:"1999.98px"},Re=(()=>{let e=0;return function(){return e+=1,`${arguments.length>0&&void 0!==arguments[0]?arguments[0]:""}${e}`}})(),Ke=k({compatConfig:{MODE:3},name:"ALayoutSider",inheritAttrs:!1,props:S({prefixCls:String,collapsible:{type:Boolean,default:void 0},collapsed:{type:Boolean,default:void 0},defaultCollapsed:{type:Boolean,default:void 0},reverseArrow:{type:Boolean,default:void 0},zeroWidthTriggerStyle:{type:Object,default:void 0},trigger:z.any,width:z.oneOfType([z.number,z.string]),collapsedWidth:z.oneOfType([z.number,z.string]),breakpoint:z.oneOf(E("xs","sm","md","lg","xl","xxl","xxxl")),theme:z.oneOf(E("light","dark")).def("dark"),onBreakpoint:Function,onCollapse:Function},{collapsible:!1,defaultCollapsed:!1,reverseArrow:!1,width:200,collapsedWidth:80}),emits:["breakpoint","update:collapsed","collapse"],setup(e,a){let{emit:t,attrs:l,slots:o}=a;const{prefixCls:s}=_("layout-sider",e),n=I(Ie,void 0),i=B(!!(void 0!==e.collapsed?e.collapsed:e.defaultCollapsed)),r=B(!1);F((()=>e.collapsed),(()=>{i.value=!!e.collapsed})),w(Be,i);const d=(a,l)=>{void 0===e.collapsed&&(i.value=a),t("update:collapsed",a),t("collapse",a,l)},u=B((e=>{r.value=e.matches,t("breakpoint",e.matches),i.value!==e.matches&&d(e.matches,"responsive")}));let c;function p(e){return u.value(e)}const m=Re("ant-sider-");n&&n.addSider(m),L((()=>{F((()=>e.breakpoint),(()=>{try{null==c||c.removeEventListener("change",p)}catch(a){null==c||c.removeListener(p)}if("undefined"!=typeof window){const{matchMedia:t}=window;if(t&&e.breakpoint&&e.breakpoint in Pe){c=t(`(max-width: ${Pe[e.breakpoint]})`);try{c.addEventListener("change",p)}catch(a){c.addListener(p)}p(c)}}}),{immediate:!0})})),$((()=>{try{null==c||c.removeEventListener("change",p)}catch(e){null==c||c.removeListener(p)}n&&n.removeSider(m)}));const v=()=>{d(!i.value,"clickTrigger")};return()=>{var a,t;const n=s.value,{collapsedWidth:d,width:u,reverseArrow:c,zeroWidthTriggerStyle:p,trigger:m=(null===(a=o.trigger)||void 0===a?void 0:a.call(o)),collapsible:g,theme:h}=e,f=i.value?d:u,b=(k=f,!isNaN(parseFloat(k))&&isFinite(k)?`${f}px`:String(f));var k;const _=0===parseFloat(String(d||0))?y("span",{onClick:v,class:q(`${n}-zero-width-trigger`,`${n}-zero-width-trigger-${c?"right":"left"}`),style:p},[m||y(Qe,null,null)]):null,x={expanded:y(c?Fe:ye,null,null),collapsed:y(c?ye:Fe,null,null)},w=i.value?"collapsed":"expanded",C=null!==m?_||y("div",{class:`${n}-trigger`,onClick:v,style:{width:b}},[m||x[w]]):null,A=[l.style,{flex:`0 0 ${b}`,maxWidth:b,minWidth:b,width:b}],S=q(n,`${n}-${h}`,{[`${n}-collapsed`]:!!i.value,[`${n}-has-trigger`]:g&&null!==m&&!_,[`${n}-below`]:!!r.value,[`${n}-zero-width`]:0===parseFloat(b)},l.class);return y("aside",j(j({},l),{},{class:S,style:A}),[y("div",{class:`${n}-children`},[null===(t=o.default)||void 0===t?void 0:t.call(o)]),g||r.value&&_?C:null])}}}),Ge=Ke,Ye=He,Ze=b(Te,{Header:Oe,Footer:De,Content:He,Sider:Ke,install:e=>(e.component(Te.name,Te),e.component(Oe.name,Oe),e.component(De.name,De),e.component(Ke.name,Ke),e.component(He.name,He),e)}),We=P(k({__name:"AddInput",setup(e){const{getList:a,setCurrentId:o,setCurrentKbName:s,setDefault:d}=n(),{selectList:u}=M(n()),{setModalVisible:c}=i(),{modalVisible:p}=M(i()),m=x(""),g=v().common,h=async()=>{if(m.value.length)try{const e=await t(await l.createKb({kb_name:m.value}));m.value="",o(null==e?void 0:e.kb_id),s(null==e?void 0:e.kb_name),u.value.push(null==e?void 0:e.kb_id),await a(),c(!p.value),d(r.optionlist)}catch(e){Q.error(e.msg||g.error)}else Q.error(g.errorKnowledge)};return(e,a)=>{const t=me;return T(),O(t,{value:U(m),"onUpdate:value":a[0]||(a[0]=e=>V(m)?m.value=e:null),class:"add-input",placeholder:U(g).newPlaceholder},{suffix:D((()=>[H("div",{class:"add-button",onClick:h},N(U(g).new),1)])),_:1},8,["value","placeholder"])}}}),[["__scopeId","data-v-90404dd2"]]),Xe=["onClick"],Je={class:"tools-box"},ea=["onClick"],aa={class:"tool-name"},ta=["onClick"],la={class:"tool-name"},oa=["onClick"],sa={class:"tool-name"},na={class:"content"},ia={class:"title"},ra={class:"normal"},da={class:"title-text"},ua={class:"editing"},ca={class:"title-text"},pa={class:"icon-box"},ma=P(k({__name:"SiderCard",props:{list:{type:Array,require:!0,default:()=>[]},style:{type:Object,default:()=>({width:"232px"})}},setup(e){const a=v().common,{setShowDeleteModal:o,setCurrentId:s,setCurrentKbName:i,setDefault:d}=n(),{showDeleteModal:u,selectList:c,currentId:p}=M(n()),m=e,g=x(""),h=C((()=>m.list.map((e=>{if(!e.kb_id.includes("_QUICK"))return e}))));return(e,n)=>{const v=ee,f=me,b=ve;return T(!0),R(J,null,K(U(h),((e,n)=>(T(),R("div",{key:n,class:G([{active:U(c).includes(e.kb_id),"card-option-active":U(p)===e.kb_id},"card"]),style:Y(m.style),onClick:a=>(e=>{if(e.edit)return;const a=e.kb_id;if(c.value.includes(a)){const e=c.value.findIndex((e=>e===a));-1!=e&&c.value.splice(e,1)}else c.value.push(a)})(e)},[y(b,{"overlay-class-name":"card-hover",placement:"right"},{content:D((()=>[H("div",Je,[H("ul",null,[H("li",{onClick:a=>(e=>{s(e.kb_id),i(e.kb_name),d(r.optionlist)})(e)},[y(v,{class:"edit",name:"icon-manage"}),H("span",aa,N(U(a).manage),1)],8,ea),H("li",{onClick:a=>(e=>{s(e.kb_id),g.value=e.kb_name,e.edit=!e.edit})(e)},[y(v,{class:"edit",name:"edit"}),H("span",la,N(U(a).rename),1)],8,ta),H("li",{onClick:a=>(e=>{o(!u.value),s(e.kb_id)})(e)},[y(v,{class:"delete",name:"delete"}),H("span",sa,N(U(a).delete),1)],8,oa)])])])),default:D((()=>[H("div",na,[H("div",ia,[Z(H("div",ra,[H("p",da,N(e.kb_name),1)],512),[[W,!e.edit]]),Z(H("div",ua,[H("p",ca,[y(f,{value:e.kb_name,"onUpdate:value":a=>e.kb_name=a,type:"text"},null,8,["value","onUpdate:value"])]),H("span",pa,[y(v,{class:"edit",name:"card-confirm",onClick:X((o=>(async e=>{try{await t(await l.kbConfig({kb_id:e.kb_id,new_kb_name:e.kb_name})),g.value="",e.edit=!e.edit,Q.success(a.renameSucceeded)}catch(o){Q.error(o.msg||a.renameFailed)}})(e)),["stop"])},null,8,["onClick"]),y(v,{class:"delete",name:"card-cancel",onClick:X((a=>(e=>{e.kb_name=g.value,g.value="",e.edit=!e.edit})(e)),["stop"])},null,8,["onClick"])])],512),[[W,e.edit]])])])])),_:2},1024)],14,Xe)))),128)}}}),[["__scopeId","data-v-0d63670f"]]),va={class:"mt-50px"},ga={class:"basic-box"},ha={key:0,class:"mt3"},fa={key:1,class:"mt3"},ba={key:0,class:"loading-line-box"},ka=P(k({__name:"UploadInput",props:{kbId:{type:String,required:!0}},setup(e){const{urlList:a}=M(i()),t=v().common,l={span:10},o={span:10},s=x(null),n=x([]),r=x(""),d=x("normal"),u=()=>{if(!r.value)return void(d.value="error");const e={status:"default",text:r.value,percent:0};a.value.push(e),r.value=""},c=(e,t)=>{a.value[e].status=t};return $((()=>{n.value.forEach((e=>{clearInterval(e)}))})),(e,n)=>{const i=ee,p=me,m=ge,v=he;return T(),R("div",va,[H("div",ga,[y(p,{value:U(r),"onUpdate:value":n[0]||(n[0]=e=>V(r)?r.value=e:null),status:U(d),placeholder:U(t).urlPlaceholder,onChange:n[1]||(n[1]=e=>{r.value&&(d.value="normal")})},{suffix:D((()=>[y(i,{name:"add",class:"mt3",onClick:u})])),_:1},8,["value","status","placeholder"]),Z(H("span",{class:"red-text"},N(U(t).errTip),513),[[W,"error"===U(d)]])]),y(v,{"label-col":l,"wrapper-col":o},{default:D((()=>[(T(!0),R(J,null,K(U(a),((e,l)=>(T(),O(m,{key:l,class:"relative",onMouseenter:e=>c(l,"hover"),onMouseleave:e=>c(l,"default")},{default:D((()=>[y(p,{value:e.text,"onUpdate:value":a=>e.text=a,placeholder:U(t).urlPlaceholder},{suffix:D((()=>["hover"===e.status?(T(),R("span",ha,[y(i,{name:"card-delete",onClick:e=>(e=>{a.value.splice(e,1)})(l)},null,8,["onClick"])])):(T(),R("span",fa))])),_:2},1032,["value","onUpdate:value","placeholder"]),"parsing"===e.status?(T(),R("span",ba,[H("span",{ref_for:!0,ref_key:"percentRef",ref:s,class:"loading-line",style:Y({width:e.percent+"%"})},null,4)])):ae("",!0)])),_:2},1032,["onMouseenter","onMouseleave"])))),128))])),_:1})])}}}),[["__scopeId","data-v-2840253f"]]),ya={class:"line-url"},_a=P(k({__name:"UrlUploadDialog",setup(e){const a=v().common,{setKnowledgeName:t}=i(),{urlModalVisible:o,modalTitle:s,urlList:r}=M(i()),{currentId:u,currentKbName:c}=M(n()),{getDetails:p}=d(),{chatSettingFormActive:m}=M(fe()),g=x(!1),h=x(),f=x([]),b=C((()=>r.value.length&&r.value.every((e=>e.text.length))));F((()=>o.value),(()=>{t(c.value),o.value||(f.value=[])}));const k=async()=>{g.value=!0;await Promise.all(r.value.map(_));g.value=!1,o.value=!1,p()},_=async e=>{let a=await l.uploadUrl({chunk_size:m.value.chunkSize,kb_id:u.value,url:e.text,mode:"strong"});return null==a?void 0:a.data};return $((()=>{h.value&&clearTimeout(h.value)})),(e,t)=>{const l=oe,n=be;return T(),O(le,{to:"body"},[y(n,{open:U(o),"onUpdate:open":t[0]||(t[0]=e=>V(o)?o.value=e:null),title:U(s),centered:"",width:"480px","wrap-class-name":"upload-file-modal",onOk:k},{footer:D((()=>[y(l,{key:"submit",type:"primary",class:"upload-btn",disabled:!U(b),loading:U(g),onClick:k},{default:D((()=>[te(N(U(a).confirm),1)])),_:1},8,["disabled","loading"])])),default:D((()=>[H("div",ya,[y(ka,{"kb-id":U(u)},null,8,["kb-id"])])])),_:1},8,["open","title"])])}}}),[["__scopeId","data-v-88c2d16b"]]),xa={class:"private"},wa={class:"private-title"},Ca=P(k({__name:"DeleteModal",setup(e){const a=v().common,{showDeleteModal:t,currentId:o,selectList:s}=M(n()),{setShowDeleteModal:i,getList:r}=n(),{clearChatList:d}=ke(),{deleteChatId:u}=M(ke()),c=x(!1),p=async()=>{c.value=!0;try{if(200===(await Promise.race([await l.deleteKB({kb_ids:[o.value]}),await l.deleteKB({kb_ids:[o.value+"_FAQ"]})])).code){const e=s.value.findIndex((e=>e===o.value));-1!=e&&s.value.splice(e,1),i(!1),c.value=!1,Q.success("删除成功"),d(u.value),u.value=null,await r()}else c.value=!1,Q.error("删除失败")}catch(e){c.value=!1,Q.error(e.msg||"删除失败")}};return(e,l)=>{const o=ee,s=be;return T(),O(le,{to:"body"},[H("div",xa,[y(s,{open:U(t),"onUpdate:open":l[0]||(l[0]=e=>V(t)?t.value=e:null),"confirm-loading":U(c),centered:"",width:"480px","wrap-class-name":"private-modal","ok-text":U(a).confirm,"cancel-text":U(a).cancel,onOk:p},{title:D((()=>[H("div",wa,[y(o,{class:"info",name:"info"}),te(" "+N(U(a).deleteDec),1)])])),_:1},8,["open","confirm-loading","ok-text","cancel-text"])])])}}}),[["__scopeId","data-v-465accc6"]]),Aa={class:""};const Sa=P({},[["render",function(e,a){return T(),R("div",Aa,[se(e.$slots,"default",{},void 0,!0)])}],["__scopeId","data-v-629ddaa7"]]),Ia={class:"edit-qa-set-comp"},Ba={class:"tabs"},Fa=["onClick"],La={class:"footer"},$a={key:1,class:"upload-excel"},qa={class:"demo-download"},ja={href:"https://download.ydstatic.com/ead/QAnything_QA_模板.xlsx",download:"QAnything_QA_模板.xlsx"},za={class:"box"},Ea={key:0,class:"before-upload-box"},Ma=["accept"],Ta={class:"before-upload"},Oa={class:"upload-text-box"},Da={key:0},Ha={class:"upload-text"},Na={class:"blue"},Ua={key:1},Va={class:"upload-text"},Qa={class:"blue"},Pa={class:"list"},Ra={class:"name"},Ka={class:"status-box"},Ga={key:1,class:"loading",src:u,alt:"loading"},Ya={class:"status"},Za={class:"overly"},Wa=["accept"],Xa={class:"overly-content"},Ja=(e=>(ie("data-v-20574e15"),e=e(),re(),e))((()=>H("span",null,"重新上传",-1))),et=["src"],at=P(k({__name:"EditQaSetDialog",setup(e){const{setEditModalVisible:a,setEditQaSet:i,getFaqList:r}=d(),{editModalVisible:u,editQaSet:p,faqType:m}=M(d()),{currentId:h}=M(n()),{chatSettingFormActive:f}=M(fe()),b=v().home,k=v().common,{language:_}=M(g()),w=x(!1),C=ne({question:"",answer:"",imgs:[]}),A=x(0),S=x(!1),I=x(""),B=x(""),L=[{name:b.enterQa,value:0},{name:b.batchUpload,value:1}],$=x(!1),q=x([]);F((()=>u.value),(()=>{var e,a,t;u.value?(A.value=0,p.value&&(C.question=null==(e=p.value)?void 0:e.question,C.answer=null==(a=p.value)?void 0:a.answer,C.imgs=null==(t=p.value)?void 0:t.picUrlList)):(i(null),C.question="",C.answer="",C.imgs=[],$.value=!1,q.value=[])}),{immediate:!0});const j=async e=>{w.value=!0,"edit"===m.value&&await(async()=>{var e;try{await t(await l.deleteFile({kb_id:`${h.value}_FAQ`,file_ids:[null==(e=p.value)?void 0:e.faqId]}))}catch(a){Q.error(a.msg||"删除失败")}})();try{const a=[{question:e.question,answer:e.answer,nos_key:null}];await t(await l.uploadFaqs({kb_id:`${h.value}_FAQ`,faqs:a,chunk_size:f.value.chunkSize.toString()}));Q.success("上传成功")}catch(o){Q.error(o.msg||"获取Bot信息失败")}r(),w.value=!1,a(!1)},z=e=>{q.value=[];const a=e.target.files;Array.from(a).forEach((async(e,a)=>{try{await(async(e,a)=>new Promise(((t,l)=>{"xlsx"===e.name.split(".").pop().toLowerCase()?(q.value.push({file_name:e.name,file:e,status:"loading",errorText:k.uploading,file_id:"",order:q.value.length}),t(a)):l(e.name)})))(e,a)}catch(t){Q.error(`${t}的文件格式不符`)}})),setTimeout((()=>{q.value.length&&E()}))},E=async()=>{var e;const t=[];$.value=!0,q.value.forEach((e=>{"loading"===e.status&&t.push(e)}));const l=new FormData;for(let a=0;a<t.length;a++)l.append("files",null==(e=t[a])?void 0:e.file);l.append("user_id",o),l.append("kb_id",`${h.value}_FAQ`),fetch(s+"/local_doc_qa/upload_faqs",{method:"POST",body:l}).then((e=>{if(e.ok)return e.json();throw new Error("上传失败")})).then((e=>{200===e.code?(t.forEach(((a,t)=>{let l=e.data[t].status;l="green"==l||"gray"==l?"success":"error",q.value[a.order].status=l,q.value[a.order].errorText=k.upSucceeded})),a(!1),Q.success("上传成功")):(Q.error(e.msg||"出错了"),t.forEach((a=>{q.value[a.order].status="error",q.value[a.order].errorText=(null==e?void 0:e.msg)||k.upFailed})))})).catch((e=>{t.forEach((e=>{q.value[e.order].status=c.error,q.value[e.order].errorText=(null==e?void 0:e.msg)||k.upFailed})),Q.error(JSON.stringify(e.message)||"出错了")})),r()},P=()=>{S.value=!1,B.value=""};return(e,t)=>{const l=me,o=ge,s=_e,n=oe,i=he,r=ee,d=Sa,c=be;return T(),O(le,{to:"body"},[y(c,{open:U(u),"onUpdate:open":t[5]||(t[5]=e=>V(u)?u.value=e:null),title:U(b).inputQa,centered:"",destroyOnClose:!0,width:"480px","wrap-class-name":"edit-qa-set-modal",footer:null},{default:D((()=>[H("div",Ia,[H("div",Ba,[(T(),R(J,null,K(L,(e=>H("div",{class:G(["tab-item",U(A)===e.value?"tab-item-active":""]),key:e.name,onClick:a=>{return t=e.value,void(A.value=t);var t}},N(e.name),11,Fa))),64))]),0===U(A)?(T(),O(i,{key:0,model:U(C),name:"edit_qa_set",class:"edit-qa-set-form",onFinish:j},{default:D((()=>[y(o,{name:"question",rules:[{required:!0,message:U(b).plsInputQ}]},{default:D((()=>[y(l,{value:U(C).question,"onUpdate:value":t[0]||(t[0]=e=>U(C).question=e),placeholder:U(b).setQPlaceholder,"show-count":"",maxlength:100,"allow-clear":""},null,8,["value","placeholder"])])),_:1},8,["rules"]),y(o,{name:"answer",rules:[{required:!0,message:U(b).plsInputA}]},{default:D((()=>[y(s,{value:U(C).answer,"onUpdate:value":t[1]||(t[1]=e=>U(C).answer=e),placeholder:U(b).setAPlaceholder,"show-count":"",maxlength:1e3,"auto-size":{minRows:5,maxRows:5}},null,8,["value","placeholder"])])),_:1},8,["rules"]),y(o,null,{default:D((()=>[H("div",La,[y(n,{class:"cancel-btn",onClick:t[2]||(t[2]=e=>U(a)(!1))},{default:D((()=>[te(N(U(k).cancel),1)])),_:1}),y(n,{loading:U(w),type:"primary","html-type":"submit",class:"login-form-btn"},{default:D((()=>[te(N(U(k).confirm2),1)])),_:1},8,["loading"])])])),_:1})])),_:1},8,["model"])):(T(),R("div",$a,[H("div",qa,[H("a",ja,N(U(b).downTemp),1),H("span",null,N(U(b).uploadXlsxDesc),1)]),H("div",za,[U($)?(T(),R("div",{key:1,class:G(["upload-box","upload-list",`upload-${U(q)[0].status}`])},[y(d,null,{default:D((()=>[H("ul",Pa,[(T(!0),R(J,null,K(U(q),((e,a)=>(T(),R("li",{key:a},[H("span",Ra,N(e.file_name),1),H("div",Ka,["loading"!=e.status?(T(),O(r,{key:0,name:e.status},null,8,["name"])):(T(),R("img",Ga)),H("span",Ya,N(e.errorText),1)])])))),128))])])),_:1}),H("div",Za,[H("input",{class:"hide input",type:"file",accept:".xlsx",onChange:z,onClick:t[4]||(t[4]=e=>e.target.value="")},null,40,Wa),H("div",Xa,[y(r,{name:"upload-white"}),Ja])])],2)):(T(),R("div",Ea,[H("input",{class:"hide input",type:"file",accept:".xlsx",onChange:z,onClick:t[3]||(t[3]=e=>e.target.value="")},null,40,Ma),H("div",Ta,[H("div",Oa,[y(r,{name:"upload"}),"zh"===U(_)?(T(),R("p",Da,[H("span",Ha,[te(N(U(k).dragUrl),1),H("span",Na,N(U(k).click),1)])])):(T(),R("p",Ua,[H("span",Va,[H("span",Qa,N(U(k).click)+" ",1),te(N(U(k).dragUrl),1)])]))])])]))])])),y(c,{open:U(S),title:U(B),footer:null,onCancel:P,width:"auto",centered:""},{default:D((()=>[H("img",{alt:"example",style:{"max-width":"100%","max-height":"80vh",height:"auto",width:"auto",margin:"0 auto"},src:U(I)},null,8,et)])),_:1},8,["open","title"])])])),_:1},8,["open","title"])])}}}),[["__scopeId","data-v-20574e15"]]),tt={class:"new-bots-comp"},lt={class:"item-title"},ot=(e=>(ie("data-v-f21bf3f2"),e=e(),re(),e))((()=>H("span",null,"*",-1))),st={class:"item-title"},nt={class:"footer"},it=P(k({__name:"NewBotsDialog",setup(e){const{changePage:a}=Ce(),{newBotsVisible:o}=M(xe()),{setNewBotsVisible:s,setCurBot:n,setTabIndex:i}=xe(),{setQaList:r}=we(),d=v().bots,u=v().common,c=x(!1),p=x(null),m=ne({name:"",introduction:""}),g=async e=>{try{const o=await t(await l.createBot({bot_name:e.name,description:e.introduction}));await(async e=>{try{const a=await t(await l.queryBotInfo({bot_id:e}));n(a[0])}catch(a){Q.error(a.msg||"获取Bot信息失败")}})(o.bot_id),Q.success(d.creationSuccessful),i(0),r([]),m.name="",m.introduction="",p.value=null,a(`/bots/${o.bot_id}/edit`)}catch(o){Q.error(o.msg||"创建失败")}s(!1)},h=e=>{};return(e,a)=>{const t=me,l=ge,n=_e,i=oe,r=he,p=be;return T(),O(le,{to:"body"},[y(p,{open:U(o),"onUpdate:open":a[3]||(a[3]=e=>V(o)?o.value=e:null),title:U(d).createBots,centered:"",destroyOnClose:!0,width:"480px","wrap-class-name":"new-bot-modal",footer:null},{default:D((()=>[H("div",tt,[y(r,{model:U(m),name:"new_bots",class:"new-bots-form",onFinish:g,onFinishFailed:h},{default:D((()=>[y(l,{name:"name",rules:[{required:!0,message:U(d).nameCantEmpty}]},{default:D((()=>[H("div",lt,[te(N(U(d).botName)+" ",1),ot]),y(t,{class:"name-input",value:U(m).name,"onUpdate:value":a[0]||(a[0]=e=>U(m).name=e),placeholder:U(d).inputName,"show-count":"",maxlength:20,"allow-clear":""},null,8,["value","placeholder"])])),_:1},8,["rules"]),y(l,{name:"introduction"},{default:D((()=>[H("div",st,N(U(d).botFunctionIntro),1),y(n,{class:"intro-input",value:U(m).introduction,"onUpdate:value":a[1]||(a[1]=e=>U(m).introduction=e),placeholder:U(d).introBotFunction,"show-count":"",maxlength:200,"auto-size":{minRows:3,maxRows:3}},null,8,["value","placeholder"])])),_:1}),y(l,null,{default:D((()=>[H("div",nt,[y(i,{class:"cancel-btn",onClick:a[2]||(a[2]=e=>U(s)(!1))},{default:D((()=>[te(N(U(u).cancel),1)])),_:1}),y(i,{loading:U(c),type:"primary","html-type":"submit",class:"login-form-btn"},{default:D((()=>[te(N(U(u).confirm2),1)])),_:1},8,["loading"])])])),_:1})])),_:1},8,["model"])])])),_:1},8,["open","title"])])}}}),[["__scopeId","data-v-f21bf3f2"]]),rt=e=>(ie("data-v-47573b68"),e=e(),re(),e),dt={class:"select-kenoledge-comp"},ut={class:"header"},ct=rt((()=>H("img",{class:"search-icon",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAK9SURBVFiFxZc9SBxRFIW/uzjVSgi4gYCNWCx2JpYigoGAKZPOMhbzhC2SFBaChYJgYZFYDONMYWtn0ikEIshiabKdGDBtIGsT1GaGuSl8s4yyu+7PaE4zP28455u38+67C/9Z0slDQRBMAG+AKWAMKNmhOnACVIFdY8xxrgBBEMyIyJqqTnZkJnKkqsvGmIO+ADzPG3QcZ0NVF+ytuqruAPuqWhsaGvoNcH5+/lRExoFZEZnDzoyIbEVRtFipVC66Btje3n4SRdFXYBy4BNbjON68y8zzvMGBgYF3wBJQBGqO47ycn5//0zGANakC46p6VigUXrmue3rXW2QVhmE5SZI9ERkFanEcT7WDL2QvHMfZSMNVdbrbcADXdU9VdVpVz4Bx69lSjRkIgmAG+AZcishEL+FZhWFYVtVjrn+OF60+zMYMiMiaPV3vNxyuZwJYv+XdHCAIggm71OpxHG/2G57KetVVddLWkuYAXBcZVHWnk6XTqSqVyoVdvo2MVgBT9rifV3hGqedUs8EUYAxAVWt5p2c8x9oBlADSCpenMp6lZuOFZjcfUilAHa5re94BGc96O4ATALux5KqM50k7gKo9zuYNkPGsNhtMAXYBRGTO87zBvJI9zxu023QjoymAMeZYRI6Akt1Sc5H1KonIUatuqbEKVHXZni6FYVjuN9x6LN3ybg1gjDkQkS2gmCTJnu/7w72G+74/nCTJHlAUka12LdqNOhBF0SJQE5FRETnsZSbCMCyLyGHakFjPlrrPlgxVLS8sLPzsCiA166cpBf4Cj4AvxpjXXQOk6rUtT5LkV6FQOABGgFVjzEpPABmQrv+YhGH4TFW/28sPxphPPQP0qiAI3gMfAUTkueu6P24/c6+7oX3rVQBV/ez7/siDAliIFeALMGK/ixsauG8AgKurq7fFYvHxQ2R1rX+LYk0uyg453wAAAABJRU5ErkJggg==",alt:"search-icon"},null,-1))),pt={class:"content"},mt=rt((()=>H("img",{src:Ae,alt:"knowledge"},null,-1))),vt={class:"detail-info"},gt={class:"kb-name"},ht=["onClick"],ft={class:"bottom-text"},bt=P(k({__name:"SelectKnowledgeDialog",setup(a){const{changePage:o}=Ce(),{selectKnowledgeVisible:s,knowledgeList:n,curBot:i}=M(xe()),{setCurBot:r}=xe(),{setNavIndex:d}=e(),u=x(""),c=v().bots,p=v().common,m=C((()=>new RegExp(u.value,"i"))),g=async e=>{try{const a=await t(await l.queryBotInfo({bot_id:e}));r(a[0])}catch(a){Q.error(a.msg||"获取Bot信息失败")}},h=e=>{0===e.state?(async e=>{const a=i.value.kb_ids;a.push(e.kb_id);try{await t(await l.updateBot({bot_id:i.value.bot_id,kb_ids:a})),g(i.value.bot_id),n.value=n.value.map((a=>(a.kb_id===e.kb_id&&(a.state=0===a.state?1:0),a)))}catch(o){Q.error(o.msg||"请求失败")}})(e):(async e=>{let a=i.value.kb_ids;a=a.filter((a=>a!=e.kb_id));try{await t(await l.updateBot({bot_id:i.value.bot_id,kb_ids:a})),g(i.value.bot_id),n.value=n.value.map((a=>(a.kb_id===e.kb_id&&(a.state=0===a.state?1:0),a))),Q.success(c.removalSucessful)}catch(o){Q.error(o.msg||"请求失败")}})(e)},f=()=>{d(0),o("/home"),s.value=!1};return(e,a)=>{const t=me,l=oe,o=be;return T(),O(le,{to:"body"},[y(o,{open:U(s),"onUpdate:open":a[1]||(a[1]=e=>V(s)?s.value=e:null),title:U(c).selectKb,centered:"",destroyOnClose:!0,width:"600px","wrap-class-name":"select-knowledge-modal",footer:null},{default:D((()=>[H("div",dt,[H("div",ut,[y(t,{class:"select-input",value:U(u),"onUpdate:value":a[0]||(a[0]=e=>V(u)?u.value=e:null),placeholder:U(c).search},{prefix:D((()=>[ct])),_:1},8,["value","placeholder"]),y(l,{class:"btn",type:"primary",onClick:f},{default:D((()=>[te(N(U(c).createKb),1)])),_:1})]),H("div",pt,[(T(!0),R(J,null,K(U(n).filter((e=>U(m).test(e.kb_nmame))),(e=>(T(),R("div",{class:"knowledge-item",key:e.kbId},[mt,H("div",vt,[H("div",gt,N(e.kb_name),1)]),H("div",{class:G(["button",`button-${e.state}`,`button-${U(p).type}-${e.state}`]),onClick:a=>h(e)},null,10,ht)])))),128)),H("div",ft,N(U(c).noMore),1)])])])),_:1},8,["open","title"])])}}}),[["__scopeId","data-v-47573b68"]]),kt={class:"tools-box"},yt={class:"tool-name"},_t={class:"tool-name"},xt={class:"content"},wt={class:"title"},Ct={class:"title-text"},At=P(k({__name:"SiderCardItem",props:{cardData:{}},setup(e){const{setShowDeleteModal:a,setCurrentId:t,setCurrentKbName:l,setDefault:o}=n(),{showDeleteModal:s}=M(n()),i=v().common,{chatId:d,showLoading:u,deleteChatId:c}=M(ke()),p=e,{cardData:m}=de(p);return(e,n)=>{const p=ee,v=ve;return T(),R("div",{class:G(["card",U(d)===U(m).historyId?"active":"",U(u)?"disabled":""])},[y(v,{"overlay-class-name":"card-hover",placement:"right"},{content:D((()=>[H("div",kt,[H("ul",null,[H("li",{onClick:n[0]||(n[0]=e=>{return a={kb_name:U(m).title,kb_id:U(m).kbId},t(a.kb_id),l(a.kb_name),void o(r.optionlist);var a})},[y(p,{class:"edit",name:"icon-manage"}),H("span",yt,N(U(i).manage),1)]),H("li",{onClick:n[1]||(n[1]=e=>{return l={kb_name:U(m).title,kb_id:U(m).kbId},c.value=m.value.historyId,a(!s.value),void t(l.kb_id);var l})},[y(p,{class:"delete",name:"delete"}),H("span",_t,N(U(i).delete),1)])])])])),default:D((()=>[H("div",xt,[H("div",wt,[H("p",Ct,N(U(m).title),1)])])])),_:1})],2)}}}),[["__scopeId","data-v-62eb2a89"]]),St={class:"sider"},It={key:0,class:"knowledge"},Bt={class:"add-btn"},Ft={class:"content"},Lt={key:1,class:"bots"},$t={key:2,class:"quick-start"},qt={class:"content"},jt=P(k({__name:"Sider",setup(a){const{knowledgeBaseList:o,currentKbName:s}=M(n()),{historyList:i,showLoading:r,chatId:d,QA_List:u,kbId:c}=M(ke()),{getChatById:g,addHistoryList:h,updateHistoryList:f,addChatList:b,addFileToBeSendList:k}=ke(),{uploadFileListQuick:_}=M(p()),{initUploadFileListQuick:x}=p(),{navIndex:w}=M(e()),{changePage:C}=Ce();const A=async(e,a)=>{if(!r.value)if(_.value.length&&(k(d.value,[..._.value]),x()),0===e){const e=await t(await l.createKb({kb_name:"未命名对话",quick:!0}));c.value=e.kb_id,u.value=[],d.value=h("未命名对话"),f("未命名对话",d.value,c.value),b(d.value,u.value)}else if(1===e){if(d.value===a.historyId)return;d.value=a.historyId,u.value=[],c.value=a.kbId,s.value=a.title,ce((()=>{g(d.value).list.forEach((e=>{var a,t,l,o,s,n,i,r;"user"===e.type?(i=e.question,r=e.fileDataList,u.value.push({question:i,type:"user",fileDataList:r})):"ai"===e.type&&(a=e.question,t=e.itemInfo,l=e.answer,o=e.picList,s=e.qaId,n=e.source,u.value.push({answer:l,itemInfo:t,question:a,type:"ai",qaId:s,copied:!1,like:!1,unlike:!1,source:n||[],showTools:!0,picList:o}))}))}))}};return ue((()=>{u.value=[],d.value=null,c.value=""})),(e,a)=>(T(),R("div",St,[0===U(w)?(T(),R("div",It,[H("div",Bt,[y(We)]),H("div",Ft,[y(ma,{list:U(o)},null,8,["list"])])])):1===U(w)?(T(),R("div",Lt,[H("div",{class:"bots-tab",onClick:a[0]||(a[0]=e=>U(C)("/bots"))},N(U(v)().bots.myBots),1),y(it),y(bt),y(m)])):2===U(w)?(T(),R("div",$t,[H("div",qt,[H("div",{class:G(["card-new",null===U(d)?"active":"",U(r)?"disabled":""]),onClick:a[1]||(a[1]=e=>A(0))},[y(ee,{name:"new-chat"}),te(" "+N(U(v)().home.newConversationQuick),1)],2),(T(!0),R(J,null,K(U(i),(e=>(T(),O(At,{key:e.historyId,"card-data":e,onClick:a=>A(1,e)},null,8,["card-data","onClick"])))),128))])])):ae("",!0),y(Se),y(Ca),y(_a),y(at)]))}}),[["__scopeId","data-v-b48b6d48"]]),zt=k({__name:"index",setup:e=>(e,t)=>{const l=Ge,o=pe("router-view"),s=Ye,n=Ze;return T(),O(n,null,{default:D((()=>[y(a),y(n,null,{default:D((()=>[y(l,{width:"280",style:{background:"#fff"}},{default:D((()=>[y(jt)])),_:1}),y(n,null,{default:D((()=>[y(s,{class:"main"},{default:D((()=>[y(o)])),_:1})])),_:1})])),_:1})])),_:1})}});export{zt as default};
